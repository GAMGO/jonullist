// >>> [ADDED] NEW FILE: src/i18n/I18nContext.js
import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

// 사전은 한 파일에 몰아서 관리 (요구: 미리 준비된 번역 적용, 자동번역 X)
const DICT = {
  ko: {
    LOGIN: '로그인',
    SIGNUP: '회원가입',
    EMAIL: '이메일',
    PASSWORD: '비밀번호',
    PASSWORD_MIN: '비밀번호 (8자리 이상)',
    INPUT_REQUIRED: '입력 필요',
    ENTER_ID_PW: '아이디와 비밀번호를 입력해주세요.',
    INVALID_CREDENTIALS: '아이디 또는 비밀번호가 올바르지 않습니다.',
    TRY_AGAIN: '다시 시도해주세요.',
    START: '시작',
    HOME_MEAL: '🥗 식단 기록',
    HOME_DATA: '👀 한눈에',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'CAMERA',
    CAMERA_HINT: '접시가 중앙에 오도록 맞춰주세요',
    PERMISSION_CAMERA_NEEDED: '카메라 권한이 필요합니다',
    PERMISSION_ALLOW: '권한 허용',
    SAVE: '저장',
    RETAKE: '다시 찍기',
    RESULT: '분석 결과',
    GOAL_SETUP: '목표 설정',
    LATER: '나중에 설정',
    CONFIRM: '확인',
    CANCEL: '취소',
    EDIT: '수정',
    EDIT_DONE: '수정 완료',
    FETCHING: '불러오는 중…',
    NO_LIST: '표시할 항목이 없습니다.',
    LOGOUT: '로그아웃',
    LANGUAGE: '언어',
    SOUND: '효과음',
    ON: '켜기',
    OFF: '끄기',
    RECOVERY: '비밀번호 복구',
    RECOVERY_SETUP: '보안질문 설정',
    RECOVERY_START_DESC: '아이디를 입력하면 질문 2개가 출제됩니다.',
    RECOVERY_ID: '아이디(이메일)',
    RECOVERY_START: '질문 받기',
    RECOVERY_ANSWER: '정답 제출',
    RECOVERY_NEW_PW: '새 비밀번호',
    RECOVERY_RESET: '비밀번호 재설정',
    RECOVERY_REGISTER_DESC: '질문 3개를 선택하고 정답/확인으로 등록하세요.',
    QUESTION_BIRTHPLACE: '내가 태어난 곳은?',
    QUESTION_ELEMENTARY_SCHOOL: '내가 다니던 초등학교는?',
    QUESTION_PET_NAME: '내 애완동물 이름은?',
    QUESTION_MOTHER_NAME: '내 어머니 이름은?',
    ANSWER: '정답',
    ANSWER_CONFIRM: '정답 확인',
    SEND: '전송',
    WALK: '걷기',
    PUSHUP: '푸시업',
    SQUAT: '스쿼트',
    DIET: '식단',
    DAILY_QUESTS: '오늘의 일일 퀘스트',
    REWARD: '보상',
    ALL_CLEARED_BONUS: '모두 완료 보너스',
    NEW: '신규',
  },
  en: {
    LOGIN: 'Login',
    SIGNUP: 'Sign Up',
    EMAIL: 'Email',
    PASSWORD: 'Password',
    PASSWORD_MIN: 'Password (min 8 chars)',
    INPUT_REQUIRED: 'Input required',
    ENTER_ID_PW: 'Please enter email and password.',
    INVALID_CREDENTIALS: 'Invalid email or password.',
    TRY_AGAIN: 'Please try again.',
    START: 'Start',
    HOME_MEAL: '🥗 Meals',
    HOME_DATA: '👀 Overview',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'CAMERA',
    CAMERA_HINT: 'Center the plate in the frame',
    PERMISSION_CAMERA_NEEDED: 'Camera permission needed',
    PERMISSION_ALLOW: 'Allow',
    SAVE: 'Save',
    RETAKE: 'Retake',
    RESULT: 'Result',
    GOAL_SETUP: 'Goal Setup',
    LATER: 'Set later',
    CONFIRM: 'Confirm',
    CANCEL: 'Cancel',
    EDIT: 'Edit',
    EDIT_DONE: 'Saved',
    FETCHING: 'Loading…',
    NO_LIST: 'No items to show.',
    LOGOUT: 'Log out',
    LANGUAGE: 'Language',
    SOUND: 'SFX',
    ON: 'On',
    OFF: 'Off',
    RECOVERY: 'Password Recovery',
    RECOVERY_SETUP: 'Security Q&A',
    RECOVERY_START_DESC: 'Enter your email to get 2 questions.',
    RECOVERY_ID: 'Email',
    RECOVERY_START: 'Get questions',
    RECOVERY_ANSWER: 'Submit answers',
    RECOVERY_NEW_PW: 'New password',
    RECOVERY_RESET: 'Reset password',
    RECOVERY_REGISTER_DESC: 'Pick 3 questions and register answer/confirm.',
    QUESTION_BIRTHPLACE: 'Where was I born?',
    QUESTION_ELEMENTARY_SCHOOL: 'My elementary school?',
    QUESTION_PET_NAME: 'My pet’s name?',
    QUESTION_MOTHER_NAME: 'My mother’s name?',
    ANSWER: 'Answer',
    ANSWER_CONFIRM: 'Confirm',
    SEND: 'Send',
    WALK: 'Walk',
    PUSHUP: 'Push-ups',
    SQUAT: 'Squats',
    DIET: 'Diet',
    DAILY_QUESTS: 'Today’s Daily Quests',
    REWARD: 'Reward',
    ALL_CLEARED_BONUS: 'All-clear bonus',
    NEW: 'New',
  },
  ja: {
    LOGIN: 'ログイン',
    SIGNUP: '新規登録',
    EMAIL: 'メール',
    PASSWORD: 'パスワード',
    PASSWORD_MIN: 'パスワード（8文字以上）',
    INPUT_REQUIRED: '入力必須',
    ENTER_ID_PW: 'メールとパスワードを入力してください。',
    INVALID_CREDENTIALS: 'メールまたはパスワードが違います。',
    TRY_AGAIN: 'もう一度お試しください。',
    START: '開始',
    HOME_MEAL: '🥗 食事記録',
    HOME_DATA: '👀 一覧',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: 'カメラ',
    CAMERA_HINT: '皿が中央に来るように合わせてください',
    PERMISSION_CAMERA_NEEDED: 'カメラ権限が必要です',
    PERMISSION_ALLOW: '許可',
    SAVE: '保存',
    RETAKE: '撮り直し',
    RESULT: '結果',
    GOAL_SETUP: '目標設定',
    LATER: '後で設定',
    CONFIRM: '確認',
    CANCEL: 'キャンセル',
    EDIT: '編集',
    EDIT_DONE: '保存しました',
    FETCHING: '読み込み中…',
    NO_LIST: '表示する項目はありません。',
    LOGOUT: 'ログアウト',
    LANGUAGE: '言語',
    SOUND: '効果音',
    ON: 'オン',
    OFF: 'オフ',
    RECOVERY: 'パスワード復旧',
    RECOVERY_SETUP: 'セキュリティ質問',
    RECOVERY_START_DESC: 'メールを入力すると2問が出題されます。',
    RECOVERY_ID: 'メール',
    RECOVERY_START: '質問を取得',
    RECOVERY_ANSWER: '回答送信',
    RECOVERY_NEW_PW: '新しいパスワード',
    RECOVERY_RESET: 'パスワード再設定',
    RECOVERY_REGISTER_DESC: '質問3つを選び、回答/確認で登録します。',
    QUESTION_BIRTHPLACE: '生まれた場所は？',
    QUESTION_ELEMENTARY_SCHOOL: '小学校は？',
    QUESTION_PET_NAME: 'ペットの名前は？',
    QUESTION_MOTHER_NAME: '母の名前は？',
    ANSWER: '回答',
    ANSWER_CONFIRM: '確認',
    SEND: '送信',
    WALK: 'ウォーキング',
    PUSHUP: '腕立て伏せ',
    SQUAT: 'スクワット',
    DIET: '食事',
    DAILY_QUESTS: '本日のデイリークエスト',
    REWARD: '報酬',
    ALL_CLEARED_BONUS: '全達成ボーナス',
    NEW: '新規',
  },
  zh: {
    LOGIN: '登录',
    SIGNUP: '注册',
    EMAIL: '邮箱',
    PASSWORD: '密码',
    PASSWORD_MIN: '密码（至少8位）',
    INPUT_REQUIRED: '需要输入',
    ENTER_ID_PW: '请输入邮箱和密码。',
    INVALID_CREDENTIALS: '邮箱或密码不正确。',
    TRY_AGAIN: '请重试。',
    START: '开始',
    HOME_MEAL: '🥗 饮食记录',
    HOME_DATA: '👀 一览',
    PROFILE: 'PROFILE',
    QUEST: 'QUEST',
    RANKING: 'RANKING',
    SETTINGS: 'SETTINGS',
    CAMERA: '相机',
    CAMERA_HINT: '请将餐盘对准画面中心',
    PERMISSION_CAMERA_NEEDED: '需要相机权限',
    PERMISSION_ALLOW: '允许',
    SAVE: '保存',
    RETAKE: '重拍',
    RESULT: '结果',
    GOAL_SETUP: '目标设置',
    LATER: '稍后设置',
    CONFIRM: '确定',
    CANCEL: '取消',
    EDIT: '编辑',
    EDIT_DONE: '已保存',
    FETCHING: '加载中…',
    NO_LIST: '无可显示内容。',
    LOGOUT: '退出登录',
    LANGUAGE: '语言',
    SOUND: '音效',
    ON: '开',
    OFF: '关',
    RECOVERY: '找回密码',
    RECOVERY_SETUP: '安全问题',
    RECOVERY_START_DESC: '输入邮箱后将出现2个问题。',
    RECOVERY_ID: '邮箱',
    RECOVERY_START: '获取问题',
    RECOVERY_ANSWER: '提交答案',
    RECOVERY_NEW_PW: '新密码',
    RECOVERY_RESET: '重置密码',
    RECOVERY_REGISTER_DESC: '选择3个问题并登记答案/确认。',
    QUESTION_BIRTHPLACE: '我出生在？',
    QUESTION_ELEMENTARY_SCHOOL: '我的小学？',
    QUESTION_PET_NAME: '我的宠物名字？',
    QUESTION_MOTHER_NAME: '我母亲的名字？',
    ANSWER: '答案',
    ANSWER_CONFIRM: '确认',
    SEND: '发送',
    WALK: '步行',
    PUSHUP: '俯卧撑',
    SQUAT: '深蹲',
    DIET: '饮食',
    DAILY_QUESTS: '今天的日常任务',
    REWARD: '奖励',
    ALL_CLEARED_BONUS: '全完成奖励',
    NEW: '新',
  },
};

const Ctx = createContext(null);
export const useI18n = () => useContext(Ctx);

export function I18nProvider({ children }) {
  const [lang, setLang] = useState('ko');

  useEffect(() => {
    (async () => {
      const v = await AsyncStorage.getItem('@i18n/lang');
      if (v) setLang(v);
    })();
  }, []);

  const t = useMemo(() => {
    const table = DICT[lang] || DICT.ko;
    return (key) => {
      const k = String(key || '').trim();
      return table[k] || k;
    };
  }, [lang]);

  const value = useMemo(() => ({
    lang,
    t,
    setLang: async (next) => {
      const v = ['ko','en','ja','zh'].includes(next) ? next : 'ko';
      setLang(v);
      try { await AsyncStorage.setItem('@i18n/lang', v); } catch {}
    }
  }), [lang, t]);

  return <Ctx.Provider value={value}>{children}</Ctx.Provider>;
}
